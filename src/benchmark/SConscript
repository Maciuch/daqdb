Import('env')

env.AppendUnique(LIBPATH=[Dir('.'), Dir('./workers')])
env.Append(CPPPATH = [Dir('.'), Dir('./workers')])

sources = Glob('*.cpp')
sources.extend(Glob('workers/*.cpp'))

benchTarget = env.Program('benchmark', sources, 
            LIBS=["pthread",
                "log4cxx",
                "store",
                "boost_program_options",
                "boost_system",
                "boost_filesystem",
                "boost_thread",
                "boost_timer",
                "boost_regex",
                "boost_date_time",
                File("#third-party/pmemkv/bin/libpmemkv.so"),
                File("#third-party/cpu-stat/libcpu-stat.a"),
                File("#third-party/csvpp/libcsvpp.a"),
                "fabricpp",
                "fabric"
                ])

copyBenchTarget = Command(target = "#/benchmark",
        source = benchTarget,
        action = Copy("$TARGET", "$SOURCE"))

env.Depends(copyBenchTarget, benchTarget)
env.Clean('#/benchmark', 'benchmark')
