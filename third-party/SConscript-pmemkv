Import('env')

pmemkv_include = [ Dir('./pmemkv'),
    Dir('./pmemkv/src'),
    Dir('./pmemkv/src/engines')]
env.Append(LIBPATH=[Dir('./pmemkv/bin')])
env.Append(CPPPATH = pmemkv_include)

PmemKV = env.Command('pmemkv/bin/libpmemkv.so', "", 'cd %s && make configure sharedlib' % Dir('#third-party/pmemkv').abspath)
env.Clean(PmemKV, 'pmemkv/bin/libpmemkv.so')
copyPmemKv = Command(target = "#/bin/libpmemkv.so",
        source = PmemKV,
        action = Copy("$TARGET", "$SOURCE"))

env.Depends(copyPmemKv, PmemKV)